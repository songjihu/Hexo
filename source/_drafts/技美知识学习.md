---
title: 技美知识学习3700：现代移动端的TBR和TBDR渲染管线
date: 2021-07-19 08:14:53
categories: 
    - [图形学]
    - [百人计划]
author: songjihu
avatar: 'http://82.156.182.226:8099/Avatar/avatar.jpg'
authorLink: 'http://82.156.182.226'
description: 移动端的渲染优化
photos: http://82.156.182.226:8099/img/my/QQ截图20210711213403.png
mathjax: true

---

学习教程来自:[【技术美术百人计划】图形 3.7 移动端TB(D)R架构基础](https://www.bilibili.com/video/BV1Bb4y167zU)

# 移动端GPU的TB(D)R架构
## 1. 当前移动端GPU概况
<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20210719084259.jpg" width="100%" height="70%" >
<center>市场占比概况（数据来自学习教程PPT）</center>
<br/>
</div>

### 1.1 移动端和桌面端功耗对比
<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20210719090114.jpg
" width="100%" height="70%" >
<center>移动端和桌面端功耗对比（数据来自学习教程PPT）差距约100倍</center>
<br/>
</div>

### 1.2 移动端和桌面端带宽对比
<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20210719090957.jpg
" width="70%" height="70%" >
<center>移动端和桌面端带宽对比（来自学习教程PPT）差距约10倍</center>
<br/>
</div>

## 2. 名词解释
SoC(System on Chip)：芯片。把CPU GPU 内存 通信基带 GPS模块等整合在一起的芯片  
System Memory：手机内存。CPU和GPU共用的一块片内LPDDR物理内存，一般有几个G  
On-chip Memory：缓存。CPU和GPU的高速SRAM的Cache缓存，一般几百K到几M，比内存快几倍到几十倍，他们都共享内存地址空间（桌面端是分开的）。在TB(D)R架构下会存储Tile的颜色、深度和模板缓冲  
Stall：GPU必须串行的2次计算之间的等待过程  
FillRate：ROP运行时钟频率 X ROP个数 X 每个时钟ROP可以处理的像素个数  
TB(D)R/Tile-Based(Deferred)Rendering：主流的移动GPU渲染架构，对应PC的IMR(Immediate Mode Rendering)。屏幕被分成16或32的像素块渲染  
TBR流程：VS-Defer-RS-PS  
TBDS流程：VS-Defer-RS-Defer-PS  
Defer：延迟，阻塞+批处理待渲染的一帧中的多个数据，然后一起处理

## 3. 立即渲染(IMR)
<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20210719094406.jpg
" width="100%" height="70%" >
<center>IMR工作流程（来自https://www.imaginationtech.com/）</center>
<br/>
</div>

## 4. 基于块元的渲染TB(D)R
1. 逐个图元（顶点着色+图元加入TileList）：阶段1执行几何相关的处理，生成Primitive List/图元列表，确定Tile上的图元有哪些  
2. 逐个分块（片元着色等）：逐Tile执行光栅化和后续处理，完成后将Frame Buffer从Tile Buffer写回System Memory中
## 5. TB(D)R的硬件渲染顺序
QQ截图20210719095939.jpg
## 6. IMR和TB(D)R对比
## 7. Binning过程

## 8. 不同GPU的Early-Depth-Test
### 8.1 Mali的FPK
### 8.2 PVR夫人HSR

## 9. 优化建议


# 作业
打包场景到Android平台，对比优化前和优化后的结果

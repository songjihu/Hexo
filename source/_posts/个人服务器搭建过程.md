---
title: 个人服务器搭建过程
author: songjihu
avatar: 'http://82.156.182.226:8099/Avatar/avatar.jpg'
authorLink: 'http://82.156.182.226'
categories: 杂记
comments: true
date: 2020-12-28 19:31:26
authorAbout:
authorDesc:
tags:
keywords:
description: win10+ubuntu server虚拟机
photos: http://82.156.182.226:8099/img/my/17032611284527.jpg
---

 <a id="回到开头"></a>
# 前言
<hr style=" border:solid; width:100px; height:1px;" color=#000000 size=1">

<font color=#999AAA >在硬盘会随时挂掉，系统会频繁重装的背景下，将大致过程记录如下以供参考

<font color=#FF0000 >2021年4月17日更新：系统第一次挂机。

<font color=#FFFFFF >

更新：完善nextcloud部分，增加hexo博客搭建、Ubuntu换源、Ubuntu修改时区。

1. 硬件环境
CPU i7-6700HQ 内存 16G 显卡 965M
2. 系统环境
[附链接](#t1)：
cn_windows_10_business_editions_version_1909_x64 
ubuntu-20.04.1-live-server-amd64
3. 目前提供的服务
备份-[nextcloud](#nextcloud安装配置)
文件共享-[win10开启文件共享](#win10开启文件共享)-[win10开启ftp](#win10开启ftp)
下载机-[比特彗星](#比特彗星)-[迅雷下载](https://www.xunlei.com/)
媒体服务-[jellyfin](#jellyfin安装配置)
字幕搜刮-[SubFinder](https://github.com/ausaki/subfinder/releases/tag/v1.0.8)
媒体信息搜刮-[tinyMediaManager](#tinyMediaManager安装配置)
虚拟机远程连接-[ssh](#开启ssh)
每日打卡-[配置](#打卡环境配置)
Ubuntu换源-[清华源](#Ubuntu换源)
Hexo基于Ubuntu搭建-[go](#Hexo博客搭建)
Ubuntu修改时区-[go](#Ubuntu修改时区)
4. 服务器常用信息查看

```bash
//系统运行时间
cat /proc/uptime| awk -F. '{run_days=$1 / 86400;run_hour=($1 % 86400)/3600;run_minute=($1 % 3600)/60;run_second=$1 % 60;printf("系统已运行：%d天%d时%d分%d秒\n",run_days,run_hour,run_minute,run_second)}'
//空间使用情况
df -h
```
<hr style=" border:solid; width:100px; height:1px;" color=#000000 size=1">

# 1.资源链接 <a id="t1"></a>
win10：[下载地址](https://next.itellyou.cn/Original/Index#)
ubuntu：[下载地址](https://ubuntu.com/download/server)
# 2.镜像制作
使用UltraISO制作启动盘
# 3.系统安装
win10安装：略（激活后主页被篡改（用校园网提供的激活工具可以避免），使用360系统急救箱查杀即可修复-[附链接](http://weishi.360.cn/jijiuxiang/index.html)）
Ubuntu安装：
1. 安装VM[下载链接](https://www.xitongtiandi.net/soft_gj/18109.html#download)
若提示兼容问题，关闭Hyper-V
2. 新建虚拟机，稍后安装系统，配置完成选择iso镜像进入安装步骤。
3. 手动分配根目录空间大小
4. 完成安装，取消升级并重启
5. 开启ssh <a id="开启ssh"></a>`sudo /etc/init.d/ssh start`
6. VM开启端口转发（虚拟机的ip使用ifconfig查询），防火墙添加入站规则即可

# 4.win10开启ftp<a id="win10开启ftp"></a>
1. 开启IIS
2. 添加ftp站点

# 5.win10开启文件共享<a id="win10开启文件共享"></a>

1. 右键属性，开启共享，在网络中选择“专用”
2. 在控制面板\网络和 Internet\网络和共享中心\高级共享设置中启用发现

# 6.比特彗星安装配置<a id="比特彗星"></a>
[下载地址](http://www.bitcomet.com/en/downloading)
1. 配置tracker：
`https://trackerslist.com/all.txt`
2. 远程下载绑定：同一局域网下，在控制面版中更改防火墙配置

# 7.nextcloud安装配置<a id="nextcloud安装配置"></a>
1. 安装nextcloud`sudo nextcloud.manual-install [用户名] [密码]`
2. 修改信任的域名/IP

```bash
sudo find / -name "config.php"
OR
sudo vim /var/snap/nextcloud/current/nextcloud/config/config.php
```

4. 在VM中映射端口（80），在win10防火墙入站规则中放行映射后的端口
5. 找到nextcloud的data目录`sudo find / -name "nextcloud"`
6. su命令排除报错`sudo passwd root`
7. 进入su权限，挂载共享目录到hgfs
```bash
makdir /mnt/hgfs
vmhgfs-fuse .host:/ /mnt/hgfs
```
8. 将data下的文件复制
```bash
cp -r /var/snap/nextcloud/common/nextcloud/data  /mnt/hgfs/F/nextcloud
```
9. 共享并挂载硬盘上的文件夹到/media

```bash
sudo /usr/bin/vmhgfs-fuse .host:/ /media -o subtype=vmhgfs-fuse,allow_other -o nonempty
```
10. 修改nextcloud配置，增加权限忽视

```bash
cd /var/snap/nextcloud/ 
'datadirectory' => '/media/F/nextcloud/data',
'check_data_directory_permissions' => false,
```

10. 重启

```bash
sudo snap restart nextcloud
sudo snap connect nextcloud:removable-media
```
11. 配置开机挂载共享目录(开头顶格)`vim  /etc/rc.local` <a id="开机启动"></a>

```bash
sudo /usr/bin/vmhgfs-fuse .host:/ /media -o subtype=vmhgfs-fuse,allow_other -o nonempty
```

 
[参考链接](https://www.cnblogs.com/Deskew/p/13798595.html) 

# 8.jellyfin安装配置<a id="jellyfin安装配置"></a>
Ubuntu server在安装时勾选了docker，故安装步骤如下[参考链接](https://www.jianshu.com/p/f8ac045d8ffa)

```bash
sudo docker pull jellyfin/jellyfin
sudo docker run -d -p 8096:8096 -v /media:/media jellyfin/jellyfin
```
docker常用命令：

```bash
sudo docker ps -n 5 //查看已开启的容器
sudo docker stop d172188d0ac2 //按照id终止容器
```
加入开机启动

```bash
vim  /etc/rc.local
sleep 10 //在挂载完成后，等待几秒再去重启容器
sudo docker restart a716083c79b0 //由于容器关闭后并没有消失，重启即可
```
# 9.tinyMediaManager安装配置<a id="tinyMediaManager安装配置"></a>
1. [下载地址](https://www.52pojie.cn/thread-1240253-1-1.html)
2. 修改host，加入以下内容

```bash
13.224.161.90 http://api.themoviedb.org
13.224.161.90 api.themoviedb.org 
13.225.103.51 api.themoviedb.org 
13.224.157.34 api.thetvdb.com
```
3. 测试`https://api.themoviedb.org/3/configuration`
# 10.打卡环境配置<a id="打卡环境配置"></a>
1. 安装python，谷歌浏览器
2. 安装依赖环境
```bash
pip install selenium
pip install pyemail
```
3. 配置浏览器驱动
查看版本：`chrome://version/`
下载驱动：`http://chromedriver.storage.googleapis.com/index.html`
将下载的驱动放入`python/lib/`目录下
将完整的目录加入环境变量PATH中
4. 控制面板-定时任务

# 11. Hexo博客搭建<a id="Hexo博客搭建"></a>
1. 搭建环境： Ubuntu 20.04
2. 安装nodejs（借助[工具N](https://blog.csdn.net/baitou1036/article/details/102149505)来安装指定的版本）

```bash
sudo apt install npm
sudo npm install -g n
sudo n 12.13.1
```
3. 安装Git（已有）`git --version`
4. 安装hexo：`sudo npm install -g hexo-cli`
5. 生成目录：`hexo init test`
6. 测试：`cd test&&hexo g&&hexo s`
7. 加入开机启动（使用nohup避免命令执行后被挂起）：

```bash
cd /home/songjihu/test
nohup hexo g&&hexo s
```

# 12. Ubuntu换源<a id="Ubuntu换源"></a>
[参考链接](https://blog.csdn.net/xiangxianghehe/article/details/105688062)

```bash
sudo rm -rf /etc/apt/sources.list
sudo vim /etc/apt/sources.list
```

```bash
sudo apt-get update
sudo apt-get upgrade
```
# 13. 修改时区<a id="Ubuntu修改时区"></a>
[参考链接](https://blog.csdn.net/fansnn/article/details/105931067)
```bash
sudo tzselect
sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
timedatectl
```


<hr style=" border:solid; width:100px; height:1px;" color=#000000 size=1">

# 完
[回到开头](#回到开头)

---
title: 【杂记】UE4多人合作
date: 2021-11-01 15:27:09
categories: 
    - [杂记]
    - [UE4]
author: songjihu
avatar: 'http://82.156.182.226:8099/Avatar/avatar.jpg'
authorLink: 'http://82.156.182.226'
description: 多人合作开发UE4项目
photos: http://82.156.182.226:8099/img/banner/4-26-banner-4-26-header-1920x848-v2-1920x848-674151069.png
mathjax: true

---
教程来源：[【如何提高ue4团队开发效率】00游戏开发流程](https://www.bilibili.com/medialist/play/149146076?from=space&business=space_channel&business_id=133034&desc=6)

# 0. 前言
最近和4个同学一起开发一个UE小游戏，内容是军舰海战一类的（虚拟仿真），最后放在实验室的CAVE平台上运行展示。所以想着大家可以在同一个项目里合作开发，所以找了一套教学视频，尝试解决这个问题。考虑到大家可能没有时间详细的看视频，我就写篇笔记总结下吧。

# 1. UE一般生产流程
1. 立项
2. 核心机制的简单实现(demo)
3. 开发：策划（数值、关卡、剧情、系统、战斗、主策），剧情策划列出所有的过场（角色设定、剧情描述、剧情方向、剧情分支图）；美术（原画、LOGO、道具、角色、动画、贴图）；配乐（音效、对白、BGM）；程序（核心机制不断改进），TA，程序。
4. 完成、发售

# 2. 版本控制
使用p4v满足多工种并行开发

## 2.1 部署P4V服务器和客户端
[p4v客户端下载](https://www.perforce.com/downloads/helix-visual-client-p4v)
<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102084948.jpg
" width="100%">
</div>
<center>新建工作空间</center>
<br>

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102085311.jpg
" width="100%">
</div>
<center>先不添加文件到服务器</center>
<br>

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102090259.jpg
" width="100%">
</div>
<center>需要更新的文件</center>
<br>

右键Mark for add->default OK->右边pengding 选中default->右键提交（ctrl+s）->填入描述->提交

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102090949.jpg
" width="100%">
</div>
<center>提交新增加的文件步骤</center>
<br>

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102092854.jpg
" width="100%">
</div>
<center>上传结束后可以在服务器一栏看到已有的文件</center>
<br>

## 2.2 简单的文件上传修改
以下操作可在菜单栏->View->History下看到操作历史

### 2.2.1 添加文件
<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102094631.jpg
" width="100%">
</div>
<center>打开本地目录</center>
<br>

在本地新建文件后，点击refresh会出现在Workspace下，上传即可（不支持空文件夹，要有具体的内容），步骤同上
<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102095157.jpg
" width="100%">
</div>
<center>完成后文件右下角的标志由一个加号变为绿点</center>
<br>

### 2.2.2 更新文件
<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102100653.jpg
" width="100%">
</div>
<center>另一个用户选中服务器中的文件/文件夹，点击获取即可同步到本地</center>
<br>

### 2.2.3 修改文件

思路就是只能由一个人编写一个文件，不能同时修改，比的就是谁先锁住。如果不锁的话，其他人也可以checkout，就会造成其中一人的工作无法提交/被覆盖的后果。所以一定要lock（谁先Lock谁NB）

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102102232.jpg
" width="100%">
</div>
<center>A：右键想要修改的文件，checkout，lock，进行修改，保存，在右边pending处选中提交即可，左边的锁会自动释放</center>
<br>

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102102157.jpg
" width="100%">
</div>
<center>B用户会看到别人checkout并lock的文件处于这样一个状态，不能进行操作（即使可以checkout并修改保存，但不能submit）</center>
<br>

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102102931.jpg
" width="100%">
</div>
<center>A用户提交后，B用户执行Refresh，会看到#1/2，表示该文件共有2个版本，本地的为第一个版本，不是最新的，选中，点击Get Latest即可更行（同2.2.2）</center>
<br>

### 2.2.4 删除文件
右键->mark for delete->提交（原理同上类似，本地和服务器均消失）  
右键->remove from workspace（只在本地消失，不影响服务器）  
不要在这个软件之外自己删除，不然服务器以为东西还在


## 3. UE资产

### 3.1 关卡文件

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102142610.jpg
" width="100%">
</div>
<center>后缀为umap的文件</center>
<br>

这里新建了一个关卡，如图
<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102144120.jpg
" width="100%">
</div>
<center>完成后需要向上边2.2.3修改文件一样，先lock再修改提交</center>
<br>

这里有个问题，构建光照的话会修改所有的关卡（Newmap M1 M2），可能需要全部都lock出来，不然无法保存构建后的关卡  

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102152219.jpg
" width="100%">
</div>
<center>选中总是加载，运行后就可以直接显示出来子关卡的内容了（需要lock主关卡和被修改的子关卡才能保存）</center>
<br>

所以我们这里在项目中，根据每个人的分工不同，可以分为以下关卡：  
Level_Main_1(空的主关卡1)：第一个场景的主关卡（下边2个关卡为子关卡）  
Level_Env_1(地形关卡WL)：第一个场景的地形  
Level_Ani_1(动画关卡TS)：第一个场景中的交互  
Level_Mod(模型关卡LXW)：制作的模型，放在单独一个关卡（下边同理，需要的时候直接拿去用）  
Level_Menu(开场关卡LLC)：游戏开始关卡  
Level_Fx(特效关卡SJH)：一些特效的关卡     

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102151118.jpg
" width="100%">
</div>
<center>简易结构图</center>
<br>

### 3.2 其他资产文件

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102142502.jpg
" width="100%">
</div>
<center>后缀为uasset的文件</center>
<br>

同理上边的一般文件操作：
1. 增：在UE4中新建的文件可以在P4V中直接提交
2. 删：在UE4中右键删除（需要先连接到源码控制，见3.3）或直接在p4v中删除（mark for delete），推荐前者
3. 改：get Latest->check->lock->ue中修改->submit
4. 更新：右键 get Latest


### 3.3 UE中连接源码控制
这样的话可以在UE里执行submit和checkout等操作（提交和迁出），新建的文件保存后自动添加到pending列表中
<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102154328.jpg
" width="100%">
</div>
<center></center>
<br>

## 4. 如何工作
工作流程：
1. 打开电脑，登入客户端，更新（get Latest）
2. 锁住自己要干的，干完提交（check-lock-submit）
3. 下班
4. 注意1：要双击进入自己负责的关卡，再开始工作
5. 注意2：不要有中文路径、文件名（提交的描述可以是中文）
6. 注意3：pengding下的列表中，可以右键revert 

<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102161736.jpg
" width="100%">
</div>
<center>config部分，也需要先checkout（迁出）->lock->submit</center>
<br>

## 5. 其他操作

### 5.1 回退操作
<div align="center">
<img src="http://82.156.182.226:8099/img/my/QQ截图20211102165946.jpg
" width="100%">
</div>
<center>填入想要回退到的版本序号即可</center>
<br>


